---
import Heading from "../../../components/common/Heading.astro";
import { getDict, getWorkshopDict } from "../../../i18n/getDict";
import Layout from "../../../layouts/Layout.astro";
import type { ImageMetadata } from "astro";

// Define static paths for the [lang] parameter
export function getStaticPaths() {
  return ["th", "en"].map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: "th" | "en" };
const t = getDict(lang === "en" ? "en" : "th");
const workshopT = getWorkshopDict(lang === "en" ? "en" : "th");

// Import all workshop images
const images = await import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/images/workshops/cover/*.{webp,jpg,png}",
  {
    eager: true,
  }
);

// Pre-compute image map for O(1) lookups
const imageMap = new Map<string, ImageMetadata>();
Object.entries(images).forEach(([path, module]) => {
  const filename = path
    .split("/")
    .pop()
    ?.replace(/\.(webp|jpg|png)$/, "");
  if (filename) {
    imageMap.set(filename, module.default);
  }
});

const getImageByCode = (code: string): ImageMetadata | undefined => {
  return imageMap.get(code);
};

const seo = {
  title: lang === "en" ? "All Workshops" : "กิจกรรมเวิร์คช็อปทั้งหมด",
  description:
    lang === "en"
      ? "Join KMUTT Engineering Open House 2025 on October 10-12, 2025. Explore 10 engineering departments, workshops, exhibitions, and competitions at King Mongkut's University of Technology Thonburi (Bangmod Campus). Free registration for high school students, parents, and teachers."
      : "ร่วมงานเปิดบ้านคณะวิศวกรรมศาสตร์ มจธ. 2568 วันที่ 10-12 ตุลาคม 2568 สำรวจ 10 ภาควิชาวิศวกรรม เวิร์คช็อป นิทรรศการ และการแข่งขันที่มหาวิทยาลัยเทคโนโลยีพระจอมเกล้าธนบุรี (บางมด) ลงทะเบียนฟรีสำหรับนักเรียนมัธยมปลาย ผู้ปกครอง และครู",
  keywords:
    lang === "en"
      ? "KMUTT Engineering Open House 2025, Faculty of Engineering, Bangmod, KMUTT, Workshop, Exhibition, Competition, University, Thailand, Engineering Departments, High School, Education"
      : "งานเปิดบ้านคณะวิศวกรรมศาสตร์, มจธ, 2568, บางมด, เวิร์คช็อป, นิทรรศการ, การแข่งขัน, มหาวิทยาลัย, วิศวกรรม, นักเรียนมัธยมปลาย, การศึกษา",
  image: "https://bangmod.engineer/src/assets/logo/oph2025.webp",
  type: "website",
};
---

<Layout t={t} currentLang={lang} seo={seo}>
  <main class="mx-auto max-w-7xl px-4 py-16">
    <div class="mb-8">
      <Heading t={workshopT.title || "Workshops"} />
      <!-- <p class="text-center text-gray-600">
        {workshopT.description}
      </p> -->
    </div>

    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {
        workshopT.workshops.map((workshop) => {
          const workshopImage = getImageByCode(workshop.code);
          return workshopImage ? (
            <article class="overflow-hidden rounded-2xl bg-white shadow-lg transition-transform hover:scale-105">
              <div class="aspect-video overflow-hidden">
                <img
                  src={workshopImage.src}
                  alt={workshop.title}
                  class="h-full w-full object-cover"
                />
              </div>
              <div class="p-6">
                <h2 class="mb-2 text-xl font-semibold">{workshop.title}</h2>
                <p class="mb-4 text-gray-600">{workshop.description}</p>
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-500">{workshop.date}</span>
                  <button class="rounded-lg bg-primary px-4 py-2 text-white transition-colors hover:bg-primary-hover">
                    {lang === "en" ? "Learn More" : "เรียนรู้เพิ่มเติม"}
                  </button>
                </div>
              </div>
            </article>
          ) : null;
        })
      }
    </div>
  </main>
</Layout>
