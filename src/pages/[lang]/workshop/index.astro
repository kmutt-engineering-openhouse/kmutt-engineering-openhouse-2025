---
import Heading from "../../../components/common/Heading.astro";
import { getDict, getWorkshopDict } from "../../../i18n/getDict";
import Layout from "../../../layouts/Layout.astro";
import type { ImageMetadata } from "astro";

// Define static paths for the [lang] parameter
export function getStaticPaths() {
  return ["th", "en"].map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: "th" | "en" };
const t = getDict(lang === "en" ? "en" : "th");
const workshopT = getWorkshopDict(lang === "en" ? "en" : "th");

// Import all workshop images
const images = await import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/images/workshops/cover/*.{webp,jpg,png}",
  {
    eager: true,
  }
);

// Pre-compute image map for O(1) lookups
const imageMap = new Map<string, ImageMetadata>();
Object.entries(images).forEach(([path, module]) => {
  const filename = path
    .split("/")
    .pop()
    ?.replace(/\.(webp|jpg|png)$/, "");
  if (filename) {
    imageMap.set(filename, module.default);
  }
});

const getImageByCode = (code: string): ImageMetadata | undefined => {
  return imageMap.get(code);
};

const seo = {
  title: lang === "en" ? "All Workshops" : "กิจกรรมเวิร์คช็อปทั้งหมด",
  description:
    lang === "en"
      ? "Join KMUTT Engineering Open House 2025 on October 10-12, 2025. Explore 10 engineering departments, workshops, exhibitions, and competitions at King Mongkut's University of Technology Thonburi (Bangmod Campus). Free registration for high school students, parents, and teachers."
      : "ร่วมงานเปิดบ้านคณะวิศวกรรมศาสตร์ มจธ. 2568 วันที่ 10-12 ตุลาคม 2568 สำรวจ 10 ภาควิชาวิศวกรรม เวิร์คช็อป นิทรรศการ และการแข่งขันที่มหาวิทยาลัยเทคโนโลยีพระจอมเกล้าธนบุรี (บางมด) ลงทะเบียนฟรีสำหรับนักเรียนมัธยมปลาย ผู้ปกครอง และครู",
  keywords:
    lang === "en"
      ? "KMUTT Engineering Open House 2025, Faculty of Engineering, Bangmod, KMUTT, Workshop, Exhibition, Competition, University, Thailand, Engineering Departments, High School, Education"
      : "งานเปิดบ้านคณะวิศวกรรมศาสตร์, มจธ, 2568, บางมด, เวิร์คช็อป, นิทรรศการ, การแข่งขัน, มหาวิทยาลัย, วิศวกรรม, นักเรียนมัธยมปลาย, การศึกษา",
  image: "https://bangmod.engineer/src/assets/logo/oph2025.webp",
  type: "website",
};
---

<Layout t={t} currentLang={lang} seo={seo}>
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-primary via-primary to-primary-hover py-20">
    <div class="absolute inset-0 bg-black/10"></div>
    <div class="relative mx-auto max-w-7xl px-4 text-center">
      <h1 
        class="scroll-animate animate-fade-up mb-4 font-prompt text-4xl font-bold text-white md:text-5xl lg:text-6xl"
        data-delay="0"
      >
        {workshopT.title || "Workshops"}
      </h1>
      <p 
        class="scroll-animate animate-fade-up mx-auto max-w-3xl font-jamjuree text-lg text-white/90 md:text-xl"
        data-delay="1"
      >
        {workshopT.description || (lang === "en" ? "Discover hands-on learning experiences" : "สำรวจประสบการณ์การเรียนรู้แบบลงมือทำ")}
      </p>
    </div>
  </section>

  <!-- Workshops Grid -->
  <main class="mx-auto max-w-7xl px-4 py-16">
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {
        workshopT.workshops.map((workshop, index) => {
          const workshopImage = getImageByCode(workshop.code);
          return workshopImage ? (
            <article 
              class="scroll-animate animate-fade-up group flex flex-col overflow-hidden rounded-3xl bg-white shadow-xl transition-all duration-300 hover:-translate-y-2 hover:shadow-2xl h-full"
              data-delay={index + 1}
            >
              <!-- Image Container -->
              <div class="relative aspect-[4/3] overflow-hidden">
                <img
                  src={workshopImage.src}
                  alt={workshop.title}
                  class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                />
                <!-- Gradient Overlay -->
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                
                <!-- Date Badge -->
                <div class="absolute top-4 left-4 rounded-full bg-white/90 px-3 py-1 text-sm font-medium text-gray-800 backdrop-blur-sm">
                  {workshop.date}
                </div>
                
                <!-- Hover Icon -->
                <div class="absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 transform scale-75 group-hover:scale-100">
                  <img src="/src/assets/icons/eye.svg" alt="View" class="w-5 h-5 text-white" />
                </div>
              </div>
              
              <!-- Content -->
              <div class="flex flex-col flex-1 p-6">
                <h2 class="mb-3 font-prompt text-xl font-bold text-gray-900 group-hover:text-primary transition-colors duration-300 line-clamp-2">
                  {workshop.title}
                </h2>
                <p class="mb-6 font-jamjuree text-gray-600 leading-relaxed line-clamp-3 flex-1">
                  {workshop.description}
                </p>
                
                <!-- Action Button -->
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium text-gray-500">
                    {lang === "en" ? "Workshop" : "เวิร์คช็อป"}
                  </span>
                  <button class="group/btn flex items-center gap-2 rounded-xl bg-gradient-to-r from-primary to-primary-hover px-6 py-3 font-prompt font-semibold text-white transition-all duration-300 hover:shadow-lg hover:shadow-primary/25 hover:scale-105">
                    <span>{lang === "en" ? "Learn More" : "เรียนรู้เพิ่มเติม"}</span>
                    <img src="/src/assets/icons/arrow-right.svg" alt="Arrow" class="w-4 h-4 transition-transform duration-300 group-hover/btn:translate-x-1" style="filter: brightness(0) invert(1);" />
                  </button>
                </div>
              </div>
            </article>
          ) : null;
        })
      }
    </div>
    
    <!-- Back to Home Button -->
    <div class="mt-16 text-center">
      <a 
        href={`/${lang}/`}
        class="scroll-animate animate-fade-up inline-flex items-center gap-2 rounded-2xl border-2 border-primary bg-white px-8 py-4 font-prompt font-semibold text-primary transition-all duration-300 hover:bg-primary hover:text-white hover:shadow-lg"
        data-delay="1"
      >
        <img src="/src/assets/icons/back-arrow.svg" alt="Back" class="w-5 h-5" />
        <span>{lang === "en" ? "Back to Home" : "กลับหน้าแรก"}</span>
      </a>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        if (typeof window !== 'undefined' && (window as any).scrollAnimationManager) {
          (window as any).scrollAnimationManager.observeElements();
        }
      }, 100);
    });
  </script>
</Layout>
